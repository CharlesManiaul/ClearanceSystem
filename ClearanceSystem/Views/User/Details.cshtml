@{
    ViewData["Title"] = "Details";
}

@model Registration

@{
    string badgeClass = "bg-secondary-lt";
    string badgeText = "Inactive";
    switch (Model.Status)
    {
        case "Pending":
            badgeClass = "bg-danger-lt";
            badgeText = "Pending";
            break;

        case "Cleared":
            badgeClass = "bg-success-lt";
            badgeText = "Cleared";
            break;
    }
}

<style>
    .table {
        table-layout: fixed; /* Enforces equal width */
        width: 100%; /* Ensure the table uses full width */
    }

        .table td,
        .table th {
            vertical-align: middle;
            text-align: center;
            white-space: nowrap;
            padding: 0.75rem;
            height: 60px; /* Equal row height */
            overflow: hidden;
            text-overflow: ellipsis; /* Optional: show ... if text overflows */
        }

        .table th {
            background-color: #f8f9fa;
        }
</style>

<div class="page-header d-print-none">
    <div class="container-xxl">
        <div class="row g-2 align-items-center">
            <div class="col-6">


                <div class="page-pretitle d-flex align-items-center">
                    <h2 class="page-title mb-0">
                        Clearance Details
                    </h2>
                </div>
            </div>

            <div class="col-auto ms-auto d-print-none">

                @*                 <button class="btn btn-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-upload"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2" /><path d="M7 9l5 -5l5 5" /><path d="M12 4l0 12" /></svg>
                    UPLOAD DOCS
                </button> *@

            </div>

        </div>

    </div>
</div>

<div class="page-body">
    <div class="container-xxl">
        <!-- Left Column: Employee Information -->
        <div class="col ">
            <div class="card shadow-sm">
                <div class="card-body">
                    <span class="badge @badgeClass">@badgeText</span>

                    <h5 class="card-title m-0">@Model.Name</h5>
                    <div class="mb-0 text-muted">@Model.EmpId</div>
                    <table class="mt-3">
                        <tr>
                            <td>Hired: </td>
                            <td class="text-muted ps-5">@Model.DateHired?.ToString("MM/dd/yyyy")</td>
                        </tr>
                        <tr>
                            <td>Last Day: </td>
                            <td class="text-muted ps-5">@Model.LastDay?.ToString("MM/dd/yyyy")</td>
                        </tr>
                        <tr>
                            <td>Department: </td>
                            <td class="text-muted ps-5">@Model.DepartmentName</td>
                        </tr>
                        <tr>
                            <td>Position: </td>
                            <td class="text-muted ps-5">@Model.position</td>
                        </tr>
                    </table>

                </div>


                <div class="card-body">




                    <!-- Clear List -->
                    @if (Context.User.FindFirstValue("department") == Model.DepartmentName)
                    {


                        <div class="mb-5" id="departmentTab">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label">Assigned Department</label>
                                @*    @if (Model.clearList.Where(x => x.Status == "Cleared By Manager").Count() <= 0)
                                { }*@
                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearUserModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>



                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered" id="">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Id</th> 
                                            <th>Status</th>
                                            <th>Remarks</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                            
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @if (!Model.clearList.Where(m => m.Type == "Same Department").Any())
                                        {
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-3">
                                                    <em>No data available</em>
                                                </td>
                                            </tr>
                                        }
                                        else
                                        {
                                            var index = 1;
                                            @foreach (var row in Model.clearList.Where(m => m.Type == "Same Department"))
                                            {
                                                <tr>
                                                    <td>@row.ClearedBy</td>
                                                    <td>@index</td> <!-- Start at 1 and increment -->
                                                    <td>@row.Status</td>
                                                    <td>@row.Remarks</td>
                                                    <td>@row.UpdatedBy</td>
                                                    <td>@row.UpdatedDate</td>
                                                    <td data-label="File Name" class="text-nowrap sort-Description">

                                                        @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                        {
                                                            <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                            target="_blank"
                                                            style="text-decoration: none; color: inherit;">
                                                                @file.FileName
                                                            </a>
                                                            <br/> <!-- Show each file on a new line -->
                                                        }

                                                    </td>

                                                   @*  <td>
                                                        <a class="btn btn-warning py-1 px-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                                            Clear
                                                        </a>
                                                    </td> *@


                                                </tr>
                                                index++;
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>


                        <!-- Turnover Checklist -->
                        @using (Html.BeginForm("Turnover", "User", FormMethod.Post, new { id = "form-turnover" }))
                        {

                            @if (Model.assetList.Count() > 0)
                            {
                                <div id="turnovertab">
                                    <div class="d-flex mb-2">
                                        <label class="form-label">Turnover Asset</label>

                                        <a type="button" class="btn btn-danger ms-auto py-1 px-2" data-bs-toggle="modal" data-bs-target="#turnoverModal">Turnover</a>
                                    </div>

                                    <!-- Turnover Table -->
                                    <div class="table-responsive">
                                        <table class="table table-hover table-striped table-bordered" id="selectedItemsTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="checkAll" class="form-check-input" />
                                                    </th>
                                                    <th>ID</th>
                                                    <th>Description</th>
                                                    <th>Specification</th>
                                                    <th>Asset Number</th>
                                                    <th>Serial Number</th>
                                                    <th>Owner Name</th>
                                                    <th>Location</th>
                                                </tr>
                                            </thead>


                                            @Html.HiddenFor(m => m.RId)
                                            @Html.HiddenFor(m => m.Employee.Name, new { id = "TName" })
                                            @Html.HiddenFor(m => m.Employee.Remarks, new { id = "TRemarks" })
                                            @Html.HiddenFor(m => m.Employee.EmpId, new { id = "TEmpId" })
                                            <tbody>

                                                @for (int i = 0; i < Model.assetList.Count(); i++)
                                                {
                                                    <tr>
                                                        <td>
                                                            @Html.CheckBoxFor(m => m.assetList[i].IsSelected, new { @class = "form-check-input asset-checkbox", id = "checkbox-@checkboxIndex", @checked = "checked" })
                                                        </td>
                                                        <td>
                                                            @Model.assetList[i].AId
                                                            @Html.HiddenFor(m => m.assetList[i].AId)
                                                        </td>
                                                        <td>@Model.assetList[i].Description</td>
                                                        <td>@Model.assetList[i].Specs</td>
                                                        <td>@Model.assetList[i].AssetNo</td>
                                                        <td>@Model.assetList[i].SerialNo</td>
                                                        <td>
                                                            @Model.assetList[i].OwnerName
                                                            @Html.HiddenFor(m => m.assetList[i].OwnerName)
                                                        </td>
                                                        <td>@Model.assetList[i].Location</td>
                                                    </tr>

                                                }
                                            </tbody>
                                        </table>


                                    </div>

                                </div>
                            }
                        }

                    }


                    @if (User.IsInRole("CAApprover") || User.IsInRole("CLApprover") || User.IsInRole("DDApprover"))
                    {

                        <div class="mb-5" id="accountingTab">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label">Accounting Department</label>

                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>

                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered" id="">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Id</th>
                                            <th>Status</th>
                                            <th>Remarks</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                            @* <th>Action</th> *@
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @if (!Model.clearList.Where(m => m.Type == "Accounting").Any())
                                        {
                                            <tr>
                                                <td colspan="7" class="text-center text-muted py-3">
                                                    <em>No data available</em>
                                                </td>
                                            </tr>
                                        }
                                        else
                                        {
                                            var index = 1;
                                            @foreach (var row in Model.clearList.Where(m => m.Type == "Accounting"))
                                            {
                                                <tr>
                                                    <td>@row.ClearedBy</td>
                                                    <td>@index</td> <!-- Start at 1 and increment -->
                                                    <td>@row.Status</td>
                                                    <td>@row.Remarks</td>
                                                    <td>@row.UpdatedBy</td>
                                                    <td>@row.UpdatedDate</td>
                                                    <td data-label="File Name" class="text-nowrap sort-Description">

                                                        @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                        {
                                                            <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                            target="_blank"
                                                            style="text-decoration: none; color: inherit;">
                                                                @file.FileName
                                                            </a>
                                                            <br/>
                                                        }
                                                    </td>



                                                  @*   <td>
                                                        <a class="btn btn-warning py-1 px-2"> 
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                                            Clear
                                                        </a>
                                                    </td> *@



                                                </tr>
                                                index++;
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>



                        @*  <!-- Cash Advance -->
                        @if (User.IsInRole("CAApprover"))
                        {
                            <label class="form-label">Cash Advance</label>

                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Status</th>
                                            <th>Department</th>
                                            <th>Personnel</th>
                                            <th>Amount</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.cashAdvance == null || !Model.cashAdvance.Any())
                                        {
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">No Data Available</td>
                                            </tr>
                                        }
                                        else
                                        {
                                            foreach (var row in Model.cashAdvance)
                                            {
                                                <tr>
                                                    <td>@row.Status</td>
                                                    <td>@row.DepName</td>
                                                    <td>@row.personnel</td>
                                                    <td>@row.amount</td>
                                                    <td>@row.description</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>

                            @if (Model.cashAdvance != null && Model.cashAdvance.Any())
                            {
                                <div class="d-flex justify-content-end gap-3 col-auto ms-auto d-print-none p-3">
                                    <button class="btn btn-success btnRedirect">Go To EMS</button>
                                </div>
                            }
                        }
                        *@
                    }


                    @*  @if (Context.User.FindFirstValue("HumanResources") != "HumanResources" && !(Context.User.FindFirstValue("department").Equals("ACCOUNTING", StringComparison.OrdinalIgnoreCase) ||
                    Context.User.FindFirstValue("department").Equals("FINANCE", StringComparison.OrdinalIgnoreCase)))
                    {
                        <div class="mb-5" id="OthersTab">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label">Other Departments</label>
                                @if (Model.userRoles.Any())
                                {
                                    <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                        Clear
                                    </button>
                                }

                            </div>

                            <div class="table-responsive">
                                <table class="table table-hover table-striped table-bordered" id="">
                                    <thead>
                                        <tr>
                                            <th>Id</th>
                                            <th>Remarks</th>
                                            <th>Status</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @if (!Model.clearList.Where(m => m.Type == "Others").Any())
                                        {
                                            <tr>
                                                <td colspan="6" class="text-center text-muted py-3">
                                                    <em>No data available</em>
                                                </td>
                                            </tr>
                                        }
                                        else
                                        {
                                            var index = 1;
                                            @foreach (var row in Model.clearList.Where(m => m.Type == "Others"))
                                            {
                                                <tr>
                                                    <td>@index</td> <!-- Start at 1 and increment -->
                                                    <td>@row.Remarks</td>
                                                    <td>@row.Status</td>
                                                    <td>@row.ClearedBy</td>
                                                    <td>@row.ClearedDate</td>
                                                    <td data-label="File Name" class="text-nowrap sort-Description">

                                                        @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                        {
                                                            <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                               target="_blank"
                                                               style="text-decoration: none; color: inherit;">
                                                                @file.FileName
                                                            </a>
                                                            <br /> <!-- Show each file on a new line -->
                                                        }

                                                    </td>
                                                </tr>
                                                index++;
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    } *@

                    

                    @if (User.IsInRole("IT"))
                    {
                        <div class="mb-5" id="ITtab">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label">IT Department</label>
                            @if (Model.userRoles.Any())
                            {
                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>
                            }

                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-striped table-bordered" id="">
                                <thead>
                                    <tr>
                                            <th></th>
                                            <th>Id</th>
                                            <th>Status</th>
                                            <th>Remarks</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                            @* <th>Action</th> *@
                                    </tr>
                                </thead>

                                <tbody>
                                @if (!Model.clearList.Where(m => m.ClearedBy == "IT").Any())
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <em>No data available</em>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        var index = 1;
                                        @foreach (var row in Model.clearList.Where(m => m.ClearedBy == "IT"))
                                        {
                                            <tr>
                                                    <td>@row.ClearedBy</td>
                                                    <td>@index</td> <!-- Start at 1 and increment -->
                                                    <td>@row.Status</td>
                                                    <td>@row.Remarks</td>
                                                    <td>@row.UpdatedBy</td>
                                                    <td>@row.UpdatedDate</td>
                                                <td data-label="File Name" class="text-nowrap sort-Description">

                                                    @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                    {
                                                        <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                           target="_blank"
                                                           style="text-decoration: none; color: inherit;">
                                                            @file.FileName
                                                        </a>
                                                        <br /> <!-- Show each file on a new line -->
                                                    }

                                                </td>

                                                @*  <td>
                                                    <a class="btn btn-warning py-1 px-2">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                                        Clear
                                                    </a>
                                                </td>
 *@
                                            </tr>
                                            index++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    }
                    
                    @if (User.IsInRole("EQS"))
                    {

                    <div class="mb-5" id="EQStab">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label">EQS Department</label>
                            @if (Model.userRoles.Any())
                            {
                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>
                            }

                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-striped table-bordered" id="">
                                <thead>
                                    <tr>
                                            <th></th>
                                            <th>Id</th>
                                            <th>Status</th>
                                            <th>Remarks</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                            @* <th>Action</th> *@
                                    </tr>
                                </thead>

                                <tbody>
                                        @if (!Model.clearList.Where(m => m.ClearedBy == "EQS").Any())
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <em>No data available</em>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        var index = 1;
                                        @foreach (var row in Model.clearList.Where(m => m.ClearedBy == "EQS"))
                                        {
                                            <tr>
                                                    <td>@row.ClearedBy</td>
                                                    <td>@index</td> <!-- Start at 1 and increment -->
                                                    <td>@row.Status</td>
                                                    <td>@row.Remarks</td>
                                                    <td>@row.UpdatedBy</td>
                                                    <td>@row.UpdatedDate</td>
                                                <td data-label="File Name" class="text-nowrap sort-Description">

                                                    @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                    {
                                                        <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                           target="_blank"
                                                           style="text-decoration: none; color: inherit;">
                                                            @file.FileName
                                                        </a>
                                                        <br /> <!-- Show each file on a new line -->
                                                    }

                                                </td>
@* 
                                                             <td>
                                                                <a class="btn btn-warning py-1 px-2">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                                                    Clear
                                                                </a>
                                                            </td> *@
                                            </tr>
                                            index++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    }
                     
                    @if (User.IsInRole("AUDIT"))
                    {
                    <div class="mb-5" id="AuditTab">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label">Audit Department</label>
                            @if (Model.userRoles.Any())
                            {
                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>
                            }

                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-striped table-bordered" id="">
                                <thead>
                                    <tr>
                                            <th></th>
                                            <th>Id</th>
                                            <th>Status</th>
                                            <th>Remarks</th>
                                            <th>Cleared By</th>
                                            <th>Cleared Date</th>
                                            <th>Attachment</th>
                                            @* <th>Action</th> *@
                                    </tr>
                                </thead>

                                <tbody>
                                    @if (!Model.clearList.Where(m => m.ClearedBy == "AUDIT").Any())
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <em>No data available</em>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        var index = 1;
                                            @foreach (var row in Model.clearList.Where(m => m.ClearedBy == "AUDIT"))
                                        {
                                            <tr>
                                                <td>@row.ClearedBy</td>
                                                <td>@index</td> <!-- Start at 1 and increment -->
                                                <td>@row.Status</td>
                                                <td>@row.Remarks</td>
                                                <td>@row.UpdatedBy</td>
                                                <td>@row.UpdatedDate</td>
                                                <td data-label="File Name" class="text-nowrap sort-Description">

                                                    @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                    {
                                                        <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                           target="_blank"
                                                           style="text-decoration: none; color: inherit;">
                                                            @file.FileName
                                                        </a>
                                                        <br /> <!-- Show each file on a new line -->
                                                    }

                                               
                                                    @* <a class="btn btn-warning py-1 px-2">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                                        Clear
                                                    </a> *@
                                                </td>
                                            </tr>
                                            index++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    }
                    
                    @if (User.IsInRole("QA"))
                    {
                    <div class="mb-5" id="QATab">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label">QA Department</label>
                            @if (Model.userRoles.Any())
                            {
                                <button type="button" class="btn btn-cyan ms-auto py-1 px-2 " data-bs-toggle="modal" data-bs-target="#clearModal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-checks"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M7 12l5 5l10 -10" /><path d="M2 12l5 5m5 -5l5 -5" /></svg>
                                    Clear
                                </button>
                            }

                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-striped table-bordered" id="">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Id</th>
                                        <th>Status</th>
                                        <th>Remarks</th>
                                        <th>Cleared By</th>
                                        <th>Cleared Date</th>
                                        <th>Attachment</th>
                                        @* <th>Action</th> *@
                                    </tr>
                                </thead>

                                <tbody>
                                    @if (!Model.clearList.Where(m => m.ClearedBy == "QA").Any())
                                    {
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-3">
                                                <em>No data available</em>
                                            </td>
                                        </tr>
                                    }
                                    else
                                    {
                                        var index = 1;
                                        @foreach (var row in Model.clearList.Where(m => m.ClearedBy == "QA"))
                                        {
                                            <tr>
                                                <td>@row.ClearedBy</td>
                                                <td>@index</td> <!-- Start at 1 and increment -->
                                                <td>@row.Status</td>
                                                <td>@row.Remarks</td>
                                                <td>@row.UpdatedBy</td>
                                                <td>@row.UpdatedDate</td>
                                                <td data-label="File Name" class="text-nowrap sort-Description">

                                                    @foreach (var file in Model.attachment.Where(m => m.RefId == row.CId))
                                                    {
                                                        <a href="@Url.Action("GetDetails", "Admin", new { file.FileName} )"
                                                           target="_blank"
                                                           style="text-decoration: none; color: inherit;">
                                                            @file.FileName
                                                        </a>
                                                        <br /> <!-- Show each file on a new line -->
                                                    }

                                                </td>
                                               
                                            </tr>
                                            index++;
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    }
               
                    
                    
                    
                </div>
            </div>
        </div>
    </div>
</div>



@using (Html.BeginForm("ClearDepartment", "User", FormMethod.Post, new { id = "form-clear", enctype = "multipart/form-data" }))
{
    <div class="modal fade" id="clearModal" tabindex="-1" aria-labelledby="clearModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header bg-primary text-white">    
                    <h5 class="modal-title" id="clearModalLabel">Clear Form Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <h1 class="mb-3">Are you sure?</h1>
                    <p class="text-muted">
                        You are about to clear the form. This action is irreversible. Make sure you really want to proceed.
                    </p>

                    <!-- Hidden Input -->
                    @Html.HiddenFor(m => m.RId)
                    @Html.HiddenFor(m => m.Level)
                    @Html.HiddenFor(m => m.EmpId)
                    @Html.HiddenFor(m => m.Clear.withIssue, new { id = "withIssue" })
                    <div class="mb-3">
                        <label class="form-label">Choose What to Clear</label>
                        <select class="form-select tom-select" asp-for="UserRoles.Roles" id="roles" required>
                            <option value="" disabled selected>Select an option to clear</option>
                            @if (Model?.userRoles != null && Model.userRoles.Any())
                            {
                                
                                    foreach (var item in Model.userRoles)
                                    {
                                   
                                        if (!string.IsNullOrWhiteSpace(item.Roles) &&
                                        !item.Roles.Equals("Manager", StringComparison.OrdinalIgnoreCase) &&
                                        !item.Roles.Equals("Supervisor", StringComparison.OrdinalIgnoreCase) &&
                                        !item.Roles.Equals("Turnover", StringComparison.OrdinalIgnoreCase))
                                        {
                                        <option value="@item.Roles">@item.Roles</option>
                                        }
                                    
                                   
                                     }
                                
                            }
                            else
                            {
                                <option disabled>No roles available to clear</option>
                            }
                        </select>



                        <!-- Second Question -->
                        <div class="mb-3" id="disableAccessContainer" style="display: none;">
                            <label class="form-label"><strong>Disable Email Address and Other Access?</strong></label>
                            <select class="form-select tom-select" id="disableAccess" asp-for="DelEmailOthers">
                                <option value="" selected disabled>Select</option>
                                <option value="true">Yes</option>
                                <option value="false">No</option>
                            </select>
                        </div>
                    </div>

                    <!-- Textarea Input -->
                    <div class="mb-3">
                        <label for="cRemarks" class="form-label">Remarks</label>
                        @Html.TextAreaFor(m => m.Clear.Remarks, new { @class = "form-control", id = "cRemarks", placeholder = "Enter your remarks here", rows = "1", @data_bs_autosize = "true" })
                        <small id="remarks-warning" class="text-danger d-none">Remarks are required when proceeding with an issue.</small>
                    </div>


                    <!-- File Upload Input -->
                    <div class="mb-3">
                        <label for="upload" class="form-label">Upload Files</label>
                        <div class="d-flex align-items-center gap-2">
                            <button type="button" class="btn btn-primary" id="upload-trigger">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-upload">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2"></path>
                                    <polyline points="7 9 12 4 17 9"></polyline>
                                    <line x1="12" y1="4" x2="12" y2="16"></line>
                                </svg>
                                Select Files
                            </button>
                            <span id="file-names" class="text-muted">No files selected</span>
                        </div>

                        <input type="file" asp-for="Files" hidden multiple />
                    </div>

                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btnIssue">Proceed with Issue</button>
                    <button type="submit" class="btn btn-success">Yes, Clear Form</button>
                </div>
            </div>
        </div>
    </div>
}



@using (Html.BeginForm("ClearDepartment", "User", FormMethod.Post, new { id = "form-clear-department", enctype = "multipart/form-data" }))
{
    <div class="modal fade" id="clearUserModal" tabindex="-1" aria-labelledby="clearModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="clearModalLabel">Clear Department Confirmation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <h1 class="mb-3">Are you sure?</h1>
                    <p class="text-muted">
                        You are about to clear the form. This action is irreversible. Make sure you really want to proceed.
                    </p>


                    <div class="mb-3">
                        <label class="form-label">Choose What to Clear</label>
                        <select class="form-select tom-select" asp-for="UserRoles.Roles" id="turnoverEmployeeId">
                            <option value="" disabled selected>Select an option to clear</option>
                            @if (Model?.userRoles != null && Model.userRoles.Any())
                            {
                                foreach (var item in Model.userRoles)
                                {
                                    @if (!string.IsNullOrWhiteSpace(item.Roles) &&
                                   (item.Roles.Equals("Manager", StringComparison.OrdinalIgnoreCase) ||
                                   item.Roles.Equals("Supervisor", StringComparison.OrdinalIgnoreCase)))
                                    {
                                        <option value="@item.Roles">@item.Roles</option>
                                    }

                                    @if (Model.assetList == null || Model.assetList.Count == 0)
                                    {
                                        <option value="Turnover">Turn Over</option>
                                    }
                                }
                            }
                            else
                            {
                                <option disabled>No roles available to clear</option>
                            }
                        </select>
                    </div>



                    <!-- Hidden Input -->
                    @Html.HiddenFor(m => m.RId)
                    @Html.HiddenFor(m => m.Level)
                    @Html.HiddenFor(m => m.EmpId)
                    @Html.HiddenFor(m => m.Clear.withIssue, new { id = "withIssue1" })
                    <!-- Textarea Input -->
                    <div class="mb-3">
                        <label for="cRemarks1" class="form-label">Remarks</label>
                        @Html.TextAreaFor(m => m.Clear.Remarks, new { @class = "form-control",id = "cRemarks1", placeholder = "Enter your remarks here", rows = "1", @data_bs_autosize = "true" })
                        <small id="remarks-warning1" class="text-danger d-none">Remarks are required when proceeding with an issue.</small>
                    </div>


                    <!-- File Upload Input -->
                    <div class="mb-3">
                        <label for="upload" class="form-label">Upload Files</label>
                        <div class="d-flex align-items-center gap-2">
                            <button type="button" class="btn btn-primary" id="upload-trigger1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icon-tabler-upload">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2"></path>
                                    <polyline points="7 9 12 4 17 9"></polyline>
                                    <line x1="12" y1="4" x2="12" y2="16"></line>
                                </svg>
                                Select Files
                            </button>
                            <span id="file-names1" class="text-muted">No files selected</span>
                        </div>

                        <input type="file" asp-for="Files" id="Files1" hidden multiple />
                    </div>

                </div>

                <!-- Modal Footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btnIssue1">Proceed with Issue</button>
                    <button type="submit" class="btn btn-success">Yes, Clear Form</button>
                </div>
            </div>
        </div>
    </div>
}



<div class="modal fade" id="turnoverModal">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="turnoverModalLabel">Turnover Asset</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Employee Details -->
                <div class="mb-3">
                    <label class="form-label">Choose Employee</label>
                    <select class="form-select tom-select-subtitle" asp-for="Employee.EmpId" id="turnoverEmployeeId">
                        <option value="" disabled selected>Select Employee</option>
                        @if (Model.employees != null && Model.employees.Any())
                        {
                            foreach (var item in Model.employees)
                            {
                                <option value="@item.EmpId" data-subtitle="@item.EmpId" data-name="@item.EmployeeName">@item.EmployeeName</option>
                            }
                        }
                        else
                        {
                            <option disabled>No Employees Available</option>
                        }
                    </select>
                </div>


                
                <!-- Remarks -->
                <div class="mb-3">
                    <label for="remarks" class="form-label">Remarks</label>
                    @Html.TextAreaFor(m => m.Employee.Remarks, new { @class = "form-control", @placeholder = "Enter Remarks", id = "TurnRemarks", data_bs_toggle = "autosize" })
                </div>

            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btnTurnover">Submit</button>
            </div>
        </div>
    </div>
</div>




@section Scripts {


    <script>
        $(document).ready(function () {
            $('#roles').change(function () {
                var selectedRole = $(this).val();
                if (selectedRole === "IT") {
                    $('#disableAccessContainer').show();
                } else {
                    $('#disableAccessContainer').hide();
                }
            });
        });
    </script>

    <script>
            $(document).ready(function () {
            $(".btnIssue").on("click", function () {
                let remarks = $("#cRemarks").val().trim();
               
                if (remarks === "") {
                    $("#remarks-warning").removeClass("d-none"); // Show warning
                    $("#cRemarks").addClass("is-invalid"); // Add red border
                } else {
                     $("#withIssue").val("true"); // Set hidden field value
                    $("#remarks-warning").addClass("d-none"); // Hide warning
                    $("#cRemarks").removeClass("is-invalid"); // Remove red border
                    $("#form-clear").submit();
                }
            });

            // Hide warning when user starts typing
            $("#cRemarks").on("input", function () {
                $("#remarks-warning").addClass("d-none");
                $(this).removeClass("is-invalid");
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            $(".btnIssue1").on("click", function () {
                let remarks = $("#cRemarks1").val().trim();
       
                if (remarks === "") {
                    $("#remarks-warning1").removeClass("d-none"); // Show warning
                    $("#cRemarks1").addClass("is-invalid"); // Add red border
                } else {
                    $("#withIssue1").val("true");
                    $("#remarks-warning1").addClass("d-none"); // Hide warning
                    $("#cRemarks1").removeClass("is-invalid"); // Remove red border
                    $("#form-clear-department").submit();
                }
            });

            // Hide warning when user starts typing
            $("#cRemarks").on("input", function () {
                $("#remarks-warning").addClass("d-none");
                $(this).removeClass("is-invalid");
            });
        });
    </script>





    <script>
        $(".btnClear").click(function () {
            $('#form-clear').submit();
        })

    </script>

    <script>
        $(document).ready(function () {
            // Initialize the "Check All" checkbox based on the state of individual checkboxes
            const initializeCheckAll = function () {
                const assetCheckboxes = $('.asset-checkbox');
                const checkAll = $('#checkAll');
                const allChecked = assetCheckboxes.length > 0 && assetCheckboxes.filter(':checked').length === assetCheckboxes.length;
                checkAll.prop('checked', allChecked);
            };

            // When the "Check All" checkbox is clicked
            $('#checkAll').click(function () {
                const isChecked = $(this).prop("checked");
                $('.asset-checkbox').prop('checked', isChecked); // Set all individual checkboxes to the same state
            });

            // When any individual checkbox is clicked
            $(document).on('click', '.asset-checkbox', function () {
                initializeCheckAll(); // Update the "Check All" checkbox
            });

            // Initialize on page load
            initializeCheckAll();

            // Handle the Turnover button click event (form submission)
            $('.btnTurnover').on('click', function () {
                var selectedAssets = [];
                var selectedEmployee = null;

                // Get selected employee information (assuming only one employee is selected)
                var selectedEmpId = $('#turnoverModal').find('.form-select option:selected').val();
                var selectedEmpName = $('#turnoverModal').find('.form-select option:selected').data('name');

                // Set employee data into the modal fields
                $('#turnoverModal').find('#turnoverEmployeeId').val(selectedEmpId); // Set Employee ID
                $('#turnoverModal').find('#turnoverEmployeeName').val(selectedEmpName); // Set Employee Name

                // Populate the textboxes
                $('#TName').val(selectedEmpName);  // Set Employee Name into the textbox
                $('#TEmpId').val(selectedEmpId);  // Set Employee ID into the textbox

                // Collect the selected asset IDs
                $('.asset-checkbox:checked').each(function () {
                    selectedAssets.push($(this).val()); // Assuming you're pushing asset Ids
                });

                // Set the selected asset IDs in the hidden input field
                $('#turnoverList').val(selectedAssets.join(','));

                // Populate the remarks
                var remarks = $('#TurnRemarks').val();
                $('#TRemarks').val(remarks);
                // Submit the form (Optional if needed)
                $('#form-turnover').submit(); // Regular form submission if needed
            });
        });
    </script>


    <script>
        $(document).ready(function () {
            // Trigger file input click when button is clicked
            $('#upload-trigger').on('click', function () {
                $('#Files').click();
            });

            // Update file names dynamically when files are selected
            $('#Files').on('change', function () {
                const fileNames = Array.from(this.files).map(file => file.name).join(', ') || 'No files selected';
                $('#file-names').text(fileNames);
            });
        });


        $(document).ready(function () {
            // Trigger file input click when button is clicked
            $('#upload-trigger1').on('click', function () {
                $('#Files1').click();
            });

            // Update file names dynamically when files are selected
            $('#Files1').on('change', function () {
                const fileNames = Array.from(this.files).map(file => file.name).join(', ') || 'No files selected';
                $('#file-names1').text(fileNames);
            });
        });
    </script>

}



